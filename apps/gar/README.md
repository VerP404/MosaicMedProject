# Приложение ГАР (Государственный адресный реестр)

Django приложение для загрузки и работы с данными ГАР (Государственный адресный реестр).

## Установка

1. Установите зависимости:
```bash
pip install -r requirements/base.txt
```

2. Убедитесь, что установлена утилита `ru_address`:
```bash
pip install ru-address
# или
git clone https://github.com/shadz3rg/ru_address.git
cd ru_address
pip install .
```

## Подготовка данных

1. Скачайте актуальную выгрузку ГАР с официального сайта:
   - https://fias.nalog.ru/Frontend
   - XSD схему: https://fias.nalog.ru/docs/gar_schemas.zip
   - XML данные (полная выгрузка ~48 ГБ)

2. Распакуйте файлы в директорию (например, `D:\GAR\`)

## Использование

### Загрузка данных для Воронежской области (регион 36)

```bash
python manage.py load_gar_data \
    --region 36 \
    --source-path "D:\GAR" \
    --format psql \
    --mode per_region
```

### Параметры команды

- `--region` - Код региона (по умолчанию 36 - Воронежская область)
- `--source-path` - Путь к распакованным файлам ГАР (обязательно)
- `--schema-path` - Путь к XSD схеме (если отличается от source-path)
- `--format` - Формат выходных данных: `psql`, `mysql`, `csv`, `tsv` (по умолчанию `psql`)
- `--mode` - Режим вывода:
  - `direct` - один файл со всеми данными
  - `per_region` - один файл на регион (рекомендуется)
  - `per_table` - один файл на таблицу
  - `region_tree` - повторяет исходную структуру файлов
- `--output-dir` - Директория для сохранения конвертированных файлов
- `--skip-conversion` - Пропустить конвертацию, использовать существующие файлы

### Примеры

#### Загрузка только Воронежской области в формате CSV

```bash
python manage.py load_gar_data \
    --region 36 \
    --source-path "D:\GAR" \
    --format csv \
    --mode per_region \
    --output-dir "D:\GAR\output"
```

#### Загрузка с использованием уже конвертированных файлов

```bash
python manage.py load_gar_data \
    --region 36 \
    --source-path "D:\GAR" \
    --format csv \
    --skip-conversion \
    --output-dir "D:\GAR\output"
```

## Структура данных

Модель `GarAddress` хранит следующую информацию:
- Иерархия адреса (регион, район, город, населенный пункт, улица, дом, квартира)
- ГАР идентификаторы (gar_object_id, parent_id)
- Почтовый индекс
- Полный адрес
- Метаданные (дата создания, обновления, активность)

## Уменьшение объема данных

Использование параметра `--region 36` позволяет обрабатывать только данные Воронежской области, что значительно уменьшает объем данных:
- Полная выгрузка ГАР: ~48 ГБ
- Выгрузка одного региона: ~100-500 МБ (зависит от региона)

## Администрирование

Данные доступны в Django Admin:
- `/admin/gar/garaddress/` - список адресов
- `/admin/gar/garloadhistory/` - история загрузок

## Примечания

- Процесс загрузки может занять значительное время (от 30 минут до нескольких часов)
- Рекомендуется использовать формат `psql` для PostgreSQL
- Для больших объемов данных используйте `--mode per_region` для лучшей производительности
- Утилита `ru_address` использует SAX парсер, что позволяет обрабатывать большие файлы с минимальным потреблением памяти (~50 МБ)



